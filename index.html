<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Barrio Legends RD</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body{
margin:0;
overflow:hidden;
background:black;
touch-action:none;
font-family:Arial;
}
canvas{
display:block;
background:#222;
}
.controls{
position:fixed;
bottom:20px;
width:100%;
display:flex;
justify-content:space-between;
padding:0 20px;
}
.btn{
width:65px;
height:65px;
border-radius:50%;
background:#444;
color:white;
display:flex;
justify-content:center;
align-items:center;
font-size:22px;
opacity:0.85;
}
.btn:active{
background:#888;
}
#hud{
position:fixed;
top:10px;
left:10px;
color:white;
}
</style>
</head>
<body>

<div id="hud">
üèç Modo: <span id="mode">Pie</span>
</div>

<canvas id="game"></canvas>

<div class="controls">
<div style="display:flex;gap:10px">
<div class="btn" id="left">‚¨ÖÔ∏è</div>
<div class="btn" id="right">‚û°Ô∏è</div>
<div class="btn" id="jump">üü¢</div>
</div>

<div>
<div class="btn" id="motor">üèç</div>
</div>
</div>

<audio id="music" loop>
<source src="audio/dembow.mp3" type="audio/mpeg">
</audio>

<script>

// Registrar Service Worker
if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let ground;
let cameraX = 0;
let mode = "foot";

class Player{
constructor(){
this.x = 100;
this.y = 0;
this.w = 50;
this.h = 70;
this.velY = 0;
this.speed = 4;
}
update(){
if(this.left) this.x -= this.speed;
if(this.right) this.x += this.speed;

if(this.jump && this.y + this.h >= ground){
this.velY = -14;
}

this.velY += 0.8;
this.y += this.velY;

if(this.y + this.h >= ground){
this.y = ground - this.h;
this.velY = 0;
}
}
draw(){
ctx.fillStyle = "red";
ctx.fillRect(this.x, this.y, this.w, this.h);
}
}

let player = new Player();

function drawMap(){
ctx.fillStyle = "#4CAF50";
ctx.fillRect(0, ground, 4000, 120);

for(let i=0;i<15;i++){
ctx.fillStyle = "#777";
ctx.fillRect(i*300+200, ground-150, 100, 150);
}
}

function loop(){
ground = canvas.height - 100;

ctx.clearRect(0,0,canvas.width,canvas.height);

cameraX = player.x - 150;

ctx.save();
ctx.translate(-cameraX,0);

drawMap();
player.update();
player.draw();

ctx.restore();

requestAnimationFrame(loop);
}
loop();

// Controles t√°ctiles
function bind(id, prop){
let btn = document.getElementById(id);
btn.addEventListener("touchstart", e=>{
e.preventDefault();
player[prop] = true;
vibrate();
});
btn.addEventListener("touchend", e=>{
e.preventDefault();
player[prop] = false;
});
}
bind("left","left");
bind("right","right");
bind("jump","jump");

// Modo Motor
document.getElementById("motor").addEventListener("touchstart",()=>{
if(mode === "foot"){
mode = "motor";
player.speed = 8;
player.h = 40;
document.getElementById("mode").textContent = "Motor";
}else{
mode = "foot";
player.speed = 4;
player.h = 70;
document.getElementById("mode").textContent = "Pie";
}
vibrate();
});

// M√∫sica inicia con primer toque
document.body.addEventListener("touchstart",()=>{
document.getElementById("music").play();
},{once:true});

// Vibraci√≥n
function vibrate(){
if(navigator.vibrate){
navigator.vibrate(50);
}
}

</script>
</body>
</html>
